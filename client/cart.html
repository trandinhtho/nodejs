<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Cart || Asbab - eCommerce HTML5 Template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Place favicon.ico in the root directory -->
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    

    <!-- All css files are included here. -->
    <!-- Bootstrap fremwork main css -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Owl Carousel min css -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <!-- This core.css file contents all plugings css file. -->
    <link rel="stylesheet" href="css/core.css">
    <!-- Theme shortcodes/elements style -->
    <link rel="stylesheet" href="css/shortcode/shortcodes.css">
    <!-- Theme main style -->
    <link rel="stylesheet" href="style.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="css/responsive.css">
    <!-- User style -->
    <link rel="stylesheet" href="css/custom.css">


    <!-- Modernizr JS -->
    <script src="js/vendor/modernizr-3.5.0.min.js"></script>
</head>

<body>
    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->  

    <!-- Body main wrapper start -->
    <div class="wrapper">
        <!-- Start Header Style -->
        <header id="htc__header" class="htc__header__area header--one">
            <!-- Start Mainmenu Area -->
            <div id="sticky-header-with-topbar" class="mainmenu__wrap sticky__header">
                <div class="container">
                    <div class="row">
                        <div class="menumenu__container clearfix">
                            <div class="col-lg-2 col-md-2 col-sm-3 col-xs-5"> 
                                <div class="logo">
                                     <a href="index.html"><img src="images/logo/4.png" alt="logo images"></a>
                                </div>
                            </div>
                            <div class="col-md-7 col-lg-8 col-sm-5 col-xs-3">
                                <nav class="main__menu__nav hidden-xs hidden-sm">
                                    <ul class="main__menu">
                                        <li class="drop"><a href="index.html">Home</a></li>
                                        <li class="drop"><a href="#">women</a>
                                            <ul class="dropdown mega_dropdown">
                                                <!-- Start Single Mega MEnu -->
                                                <li><a class="mega__title" href="product-grid.html">Shop Pages</a>
                                                    <ul class="mega__item">
                                                        <li><a href="product-grid.html">Product Grid</a></li>
                                                        <li><a href="cart.html">cart</a></li>
                                                        <li><a href="checkout.html">checkout</a></li>
                                                        <li><a href="wishlist.html">wishlist</a></li>
                                                    </ul>
                                                </li>
                                                <!-- End Single Mega MEnu -->
                                                <!-- Start Single Mega MEnu -->
                                                <li><a class="mega__title" href="product-grid.html">Variable Product</a>
                                                    <ul class="mega__item">
                                                        <li><a href="#">Category</a></li>
                                                        <li><a href="#">My Account</a></li>
                                                        <li><a href="wishlist.html">Wishlist</a></li>
                                                        <li><a href="cart.html">Shopping Cart</a></li>
                                                        <li><a href="checkout.html">Checkout</a></li>
                                                    </ul>
                                                </li>
                                                <!-- End Single Mega MEnu -->
                                                <!-- Start Single Mega MEnu -->
                                                <li><a class="mega__title" href="product-grid.html">Product Types</a>
                                                    <ul class="mega__item">
                                                        <li><a href="#">Simple Product</a></li>
                                                        <li><a href="#">Variable Product</a></li>
                                                        <li><a href="#">Grouped Product</a></li>
                                                        <li><a href="#">Downloadable Product</a></li>
                                                        <li><a href="#">Simple Product</a></li>
                                                    </ul>
                                                </li>
                                                <!-- End Single Mega MEnu -->
                                            </ul>
                                        </li>
                                        <li class="drop"><a href="#">men</a>
                                            <ul class="dropdown mega_dropdown">
                                                <!-- Start Single Mega MEnu -->
                                                <li><a class="mega__title" href="product-grid.html">Shop Pages</a>
                                                    <ul class="mega__item">
                                                        <li><a href="product-grid.html">Product Grid</a></li>
                                                        <li><a href="cart.html">cart</a></li>
                                                        <li><a href="checkout.html">checkout</a></li>
                                                        <li><a href="wishlist.html">wishlist</a></li>
                                                    </ul>
                                                </li>
                                                <!-- End Single Mega MEnu -->
                                                <!-- Start Single Mega MEnu -->
                                                <li><a class="mega__title" href="product-grid.html">Variable Product</a>
                                                    <ul class="mega__item">
                                                        <li><a href="#">Category</a></li>
                                                        <li><a href="#">My Account</a></li>
                                                        <li><a href="wishlist.html">Wishlist</a></li>
                                                        <li><a href="cart.html">Shopping Cart</a></li>
                                                        <li><a href="checkout.html">Checkout</a></li>
                                                    </ul>
                                                </li>
                                                <!-- End Single Mega MEnu -->
                                                <!-- Start Single Mega MEnu -->
                                                <li><a class="mega__title" href="product-grid.html">Product Types</a>
                                                    <ul class="mega__item">
                                                        <li><a href="#">Simple Product</a></li>
                                                        <li><a href="#">Variable Product</a></li>
                                                        <li><a href="#">Grouped Product</a></li>
                                                        <li><a href="#">Downloadable Product</a></li>
                                                        <li><a href="#">Simple Product</a></li>
                                                    </ul>
                                                </li>
                                                <!-- End Single Mega MEnu -->
                                            </ul>
                                        </li>
                                        <li class="drop"><a href="#">Product</a>
                                            <ul class="dropdown">
                                                <li><a href="product-grid.html">Product Grid</a></li>
                                                <li><a href="product-details.html">Product Details</a></li>
                                            </ul>
                                        </li>
                                        <li class="drop"><a href="blog.html">blog</a>
                                            <ul class="dropdown">
                                                <li><a href="blog.html">Blog Grid</a></li>
                                                <li><a href="blog-details.html">Blog Details</a></li>
                                            </ul>
                                        </li>
                                        <li class="drop"><a href="#">Pages</a>
                                            <ul class="dropdown">
                                                <li><a href="blog.html">Blog</a></li>
                                                <li><a href="blog-details.html">Blog Details</a></li>
                                                <li><a href="cart.html">Cart page</a></li>
                                                <li><a href="checkout.html">checkout</a></li>
                                                <li><a href="contact.html">contact</a></li>
                                                <li><a href="product-grid.html">product grid</a></li>
                                                <li><a href="product-details.html">product details</a></li>
                                                <li><a href="wishlist.html">wishlist</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="contact.html">contact</a></li>
                                    </ul>
                                </nav>

                                <div class="mobile-menu clearfix visible-xs visible-sm">
                                    <nav id="mobile_dropdown">
                                        <ul>
                                            <li><a href="index.html">Home</a></li>
                                            <li><a href="blog.html">blog</a></li>
                                            <li><a href="#">pages</a>
                                                <ul>
                                                    <li><a href="blog.html">Blog</a></li>
                                                    <li><a href="blog-details.html">Blog Details</a></li>
                                                    <li><a href="cart.html">Cart page</a></li>
                                                    <li><a href="checkout.html">checkout</a></li>
                                                    <li><a href="contact.html">contact</a></li>
                                                    <li><a href="product-grid.html">product grid</a></li>
                                                    <li><a href="product-details.html">product details</a></li>
                                                    <li><a href="wishlist.html">wishlist</a></li>
                                                </ul>
                                            </li>
                                            <li><a href="contact.html">contact</a></li>
                                        </ul>
                                    </nav>
                                </div>  
                            </div>
                            <div class="col-md-3 col-lg-2 col-sm-4 col-xs-4">
                                <div class="header__right">
                                    <div class="header__search search search__open">
                                        <a href="#"><i class="icon-magnifier icons"></i></a>
                                    </div>
                                    <div class="header__account">
                                        <a href="#"><i class="icon-user icons"></i></a>
                                    </div>
                                    <div class="htc__shopping__cart">
                                        <a class="cart__menu" href="#"><i class="icon-handbag icons"></i></a>
                                        <a href="#"><span class="htc__qua">2</span></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mobile-menu-area"></div>
                </div>
            </div>
            <!-- End Mainmenu Area -->
        </header>
        <!-- End Header Area -->

        <div class="body__overlay"></div>
        <!-- Start Offset Wrapper -->
        <div class="offset__wrapper">
            <!-- Start Search Popap -->
            <div class="search__area">
                <div class="container" >
                    <div class="row" >
                        <div class="col-md-12" >
                            <div class="search__inner">
                                <form action="#" method="get">
                                    <input placeholder="Search here... " type="text">
                                    <button type="submit"></button>
                                </form>
                                <div class="search__close__btn">
                                    <span class="search__close__btn_icon"><i class="zmdi zmdi-close"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Search Popap -->
            <!-- Start Cart Panel -->
            <div class="shopping__cart">
                <div class="shopping__cart__inner">
                    <div class="offsetmenu__close__btn">
                        <a href="#"><i class="zmdi zmdi-close"></i></a>
                    </div>
                    
                    <ul class="shopping__btn">
                        <li><a href="cart.html">View Cart</a></li>
                        <li class="shp__checkout"><a href="checkout.html">Checkout</a></li>
                    </ul>
                </div>
            </div>
            <!-- End Cart Panel -->
        </div>
        <!-- End Offset Wrapper -->
        <!-- Start Bradcaump area -->
        <div class="ht__bradcaump__area" style="background: rgba(0, 0, 0, 0) url(images/bg/1.jpg) no-repeat scroll center center / cover ;">
            <div class="ht__bradcaump__wrap">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="bradcaump__inner">
                                <nav class="bradcaump-inner">
                                  <a class="breadcrumb-item" href="index.html">Home</a>
                                  <span class="brd-separetor"><i class="zmdi zmdi-chevron-right"></i></span>
                                  <span class="breadcrumb-item active">shopping cart</span>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Bradcaump area -->
        <!-- cart-main-area start -->
        <div class="cart-main-area ptb--100 bg__white">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <form action="#">               
                            <div class="table-content table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th class="product-thumbnail">Products</th>
                                            <th class="product-name">Name of Products</th>
                                            <th class="product-price">Price</th>
                                            <th class="product-quantity">Quantity</th>
                                            <th class="product-subtotal">Total</th>
                                            <th class="product-remove">Remove</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cartTable">
                                        <!-- Cart data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Khai báo script để định nghĩa hàm getAccessToken -->
                            
                            

                            <div class="row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="buttons-cart--inner">
                                        <div class="buttons-cart">
                                            <a href="#">Continue Shopping</a>
                                        </div>
                                        <div class="buttons-cart checkout--btn">
                                            <a href="#">update</a>
                                            <a class="btn btn-danger" id="clearCartBtn" href="#">Clear</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8 col-sm-12 col-xs-12">
                                    <form>
                                        <div class="form-group">
                                          <label for="recipientName">Tên người nhận:</label>
                                          <input type="text" class="form-control" id="recipientName" placeholder="Nhập tên người nhận">
                                        </div>
                                        <div class="form-group">
                                          <label for="recipientAddress">Địa chỉ:</label>
                                          <input type="text" class="form-control" id="recipientAddress" placeholder="Nhập địa chỉ">
                                        </div>
                                        <div class="form-group">
                                          <label for="recipientPhone">Số điện thoại:</label>
                                          <input type="tel" class="form-control" id="recipientPhone" placeholder="Nhập số điện thoại">
                                        </div>
                                        <div class="form-group">
                                          <label for="recipientEmail">Email:</label>
                                          <input type="email" class="form-control" id="recipientEmail" placeholder="Nhập địa chỉ email">
                                        </div>
                                     
                                        <ul class="payment__btn">
                                            <li><a id="btnthanhtoan1" href="#">Thanh Toan</a></li>
                                        </ul>
                                      </form>
                                </div>
                                <div class="col-md-4 col-sm-12 col-xs-12 smt-40 xmt-40">
                                    <div class="htc__cart__total">
                                        <h6>cart total</h6>
                                        <div class="cart__desk__list">
                                            <ul class="cart__desc">
                                                <li>cart total</li>
                                                <li>Quantity</li>
                                                <li>shipping</li>
                                            </ul>
                                            <ul class="cart__price">
                                                <li id="totalPrice">$0.00</li>
                                                <li id="totalQuantity">0</li>
                                                <li>0</li>
                                            </ul>
                                        </div>
                                      

                                     
                                    </div>
                                </div>
                            </div>
                        </form> 
                    </div>
                </div>
            </div>
        </div>
        <!-- cart-main-area end -->
      
        
        <!-- End Banner Area -->
        <!-- Start Footer Area -->
        <footer id="htc__footer">
            <!-- Start Footer Widget -->
            <div class="footer__container bg__cat--1">
                <div class="container">
                    <div class="row">
                        <!-- Start Single Footer Widget -->
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            <div class="footer">
                                <h2 class="title__line--2">ABOUT US</h2>
                                <div class="ft__details">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim</p>
                                    <div class="ft__social__link">
                                        <ul class="social__link">
                                            <li><a href="#"><i class="icon-social-twitter icons"></i></a></li>

                                            <li><a href="#"><i class="icon-social-instagram icons"></i></a></li>

                                            <li><a href="#"><i class="icon-social-facebook icons"></i></a></li>

                                            <li><a href="#"><i class="icon-social-google icons"></i></a></li>

                                            <li><a href="#"><i class="icon-social-linkedin icons"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Single Footer Widget -->
                        <!-- Start Single Footer Widget -->
                        <div class="col-md-2 col-sm-6 col-xs-12 xmt-40">
                            <div class="footer">
                                <h2 class="title__line--2">information</h2>
                                <div class="ft__inner">
                                    <ul class="ft__list">
                                        <li><a href="#">About us</a></li>
                                        <li><a href="#">Delivery Information</a></li>
                                        <li><a href="#">Privacy & Policy</a></li>
                                        <li><a href="#">Terms  & Condition</a></li>
                                        <li><a href="#">Manufactures</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- End Single Footer Widget -->
                        <!-- Start Single Footer Widget -->
                        <div class="col-md-2 col-sm-6 col-xs-12 xmt-40 smt-40">
                            <div class="footer">
                                <h2 class="title__line--2">my account</h2>
                                <div class="ft__inner">
                                    <ul class="ft__list">
                                        <li><a href="#">My Account</a></li>
                                        <li><a href="cart.html">My Cart</a></li>
                                        <li><a href="#">Login</a></li>
                                        <li><a href="wishlist.html">Wishlist</a></li>
                                        <li><a href="checkout.html">Checkout</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- End Single Footer Widget -->
                        <!-- Start Single Footer Widget -->
                        <div class="col-md-2 col-sm-6 col-xs-12 xmt-40 smt-40">
                            <div class="footer">
                                <h2 class="title__line--2">Our service</h2>
                                <div class="ft__inner">
                                    <ul class="ft__list">
                                        <li><a href="#">My Account</a></li>
                                        <li><a href="cart.html">My Cart</a></li>
                                        <li><a href="#">Login</a></li>
                                        <li><a href="wishlist.html">Wishlist</a></li>
                                        <li><a href="checkout.html">Checkout</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- End Single Footer Widget -->
                        <!-- Start Single Footer Widget -->
                        <div class="col-md-3 col-sm-6 col-xs-12 xmt-40 smt-40">
                            <div class="footer">
                                <h2 class="title__line--2">NEWSLETTER </h2>
                                <div class="ft__inner">
                                    <div class="news__input">
                                        <input type="text" placeholder="Your Mail*">
                                        <div class="send__btn">
                                            <a class="fr__btn" href="#">Send Mail</a>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        <!-- End Single Footer Widget -->
                    </div>
                </div>
            </div>
            <!-- End Footer Widget -->
            <!-- Start Copyright Area -->
            <div class="htc__copyright bg__cat--5">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="copyright__inner">
                                <p>Copyright© <a href="https://freethemescloud.com/">Free themes Cloud</a> 2018. All right reserved.</p>
                                <a href="#"><img src="images/others/shape/paypol.png" alt="payment images"></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Copyright Area -->
        </footer>
        <!-- End Footer Style -->
    </div>
    <!-- Body main wrapper end -->

    <!-- Placed js at the end of the document so the pages load faster -->

    <!-- jquery latest version -->
    <script src="js/vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap framework js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- All js plugins included in this file. -->
    <script src="js/plugins.js"></script>
    <script src="js/slick.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <!-- Waypoints.min.js. -->
    <script src="js/waypoints.min.js"></script>
    <!-- Main js file that contents all jQuery plugins activation. -->
    <script src="js/main.js"></script>
    <script>        
       async function getAccessToken() {
            // Lấy userId từ localStorage
            const userId = localStorage.getItem('userId');
            if (!userId) {
                throw new Error('Bạn chưa đăng nhập!'); // Báo lỗi nếu không có userId
            }
            // Trả về userId
            return userId;
        }
    </script>
    
    <script>
        function parseJwt(token) {
            // Tách phần payload của token
            const payload = token.split('.')[1];

            // Giải mã payload từ base64
            const decodedPayload = atob(payload);

            // Chuyển đổi chuỗi JSON thành đối tượng JavaScript
            return JSON.parse(decodedPayload);
        }

        function extractUserIdFromToken(accessToken) {
            const decodedToken = parseJwt(accessToken);
            const userId = decodedToken.id;
            return userId;
        }
    </script>
    
    <script>
       async function fetchAndDisplayCart() {
            try {
                // Lấy dữ liệu giỏ hàng từ localStorage
                const cartData = JSON.parse(localStorage.getItem('cart'));
                console.log('Cart data:', cartData);

                // Nếu không có giỏ hàng hoặc giỏ hàng trống, hiển thị thông báo tương ứng
                if (!cartData || cartData.items.length === 0) {
                    document.getElementById('cartTable').innerHTML = '<p>Giỏ hàng của bạn đang trống.</p>';
                    document.getElementById('totalPrice').textContent = '$0.00'; // Thiết lập giá trị tổng là 0 nếu giỏ hàng trống
                    return;
                }

                // Clear existing table rows
                const cartTable = document.getElementById('cartTable');
                cartTable.innerHTML = '';

                // Add new rows for each product in the cart
                cartData.items.forEach(item => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td class="product-thumbnail"><img src="${item.productImageUrl}" alt="product img" /></td>
                        <td class="product-name">${item.productName}</td>
                        <td class="product-price">$${item.productPrice}</td>
                        <td class="product-quantity"><input type="number" value="${item.quantity}" /></td>
                        <td class="product-subtotal">$${(item.quantity * item.productPrice).toFixed(2)}</td>
                        <td class="product-remove"><button class="btn btn-danger" onclick="removeProduct('${item.productId}')"><i class="icon-trash icons"></i></button></td>
                    `;
                    cartTable.appendChild(newRow);
                });
                document.getElementById('totalPrice').innerHTML = `$${cartData.totalPrice.toFixed(2)}`;
                document.getElementById('totalQuantity').innerHTML = cartData.totalQuantity;
            } catch (error) {
                console.error('Error fetching cart data:', error);
            }
        }


        //remove item 
        async function removeProduct(productId) {
                try {
                    // Lấy dữ liệu giỏ hàng từ localStorage
                    let cartData = JSON.parse(localStorage.getItem('cart'));

                    // Nếu không có giỏ hàng, thoát khỏi hàm
                    if (!cartData || cartData.items.length === 0) {
                        return;
                    }

                    // Tìm sản phẩm trong giỏ hàng bằng productId
                    const index = cartData.items.findIndex(item => item.productId === productId);

                    // Nếu không tìm thấy sản phẩm, thoát khỏi hàm
                    if (index === -1) {
                        return;
                    }

                    // Lấy số lượng sản phẩm cần xóa
                    const removedQuantity = cartData.items[index].quantity;

                    // Xóa sản phẩm khỏi giỏ hàng
                    cartData.items.splice(index, 1);

                    // Cập nhật tổng giá và số lượng sản phẩm trong giỏ hàng
                    cartData.totalPrice = cartData.items.reduce((total, item) => total + (item.quantity * item.productPrice), 0);
                    cartData.totalQuantity = cartData.items.reduce((total, item) => total + item.quantity, 0);

                    // Lưu dữ liệu giỏ hàng đã cập nhật vào localStorage
                    localStorage.setItem('cart', JSON.stringify(cartData));

                    // Gọi lại hàm để cập nhật hiển thị giỏ hàng
                    await fetchAndDisplayCart();
                } catch (error) {
                    console.error('Error removing product:', error);
                }
            }



    </script>



   <script>
    async function Checkout(data) {
        console.log(data);
        try {
            const response = await fetch('http://localhost:3000/order/checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
        } catch (e) {
            console.log("loi");
        }
    }

    async function removeAllProducts() {
    try {
        // Lấy dữ liệu giỏ hàng từ localStorage
        let cartData = JSON.parse(localStorage.getItem('cart'));

        // Nếu không có giỏ hàng, thoát khỏi hàm
        if (!cartData || cartData.items.length === 0) {
            return;
        }

        // Xóa tất cả sản phẩm khỏi giỏ hàng
        cartData.items = [];

        // Cập nhật tổng giá và số lượng sản phẩm trong giỏ hàng
        cartData.totalPrice = 0;
        cartData.totalQuantity = 0;

        // Lưu dữ liệu giỏ hàng đã cập nhật vào localStorage
        localStorage.setItem('cart', JSON.stringify(cartData));

        // Gọi lại hàm để cập nhật hiển thị giỏ hàng
        await fetchAndDisplayCart();
    } catch (error) {
        console.error('Error removing all products:', error);
    }
}


    $(document).ready(function () {
        // Xử lý sự kiện click trên thẻ <a> có id là "btnthanhtoan1"
        $('#btnthanhtoan1').click(function (event) {
            event.preventDefault();
            const token = localStorage.getItem('userId');
            if (!token) {
                alert('Bạn cần đăng nhập');
                return;
            }

            const iduser = extractUserIdFromToken(token); // Cần cung cấp hàm extractUserIdFromToken(token) để trích xuất userId từ token
            // Nếu đã đăng nhập, thực hiện các công việc khác tại đây
            console.log('Đã đăng nhập với userId: ' + iduser);
            const recipientName = $('#recipientName').val();
            const recipientAddress = $('#recipientAddress').val();
            const recipientPhone = $('#recipientPhone').val();
            const recipientEmail = $('#recipientEmail').val();

            if (!recipientName || !recipientAddress || !recipientPhone || !recipientEmail) {
                // Nếu có bất kỳ trường nào trống, hiển thị thông báo lỗi
                alert('Vui lòng điền đầy đủ thông tin người nhận!');
                return; // Dừng xử lý tiếp theo
            }

            const cartData = JSON.parse(localStorage.getItem('cart'));

            if (!cartData || cartData.items.length === 0) {
                // Nếu giỏ hàng trống, hiển thị thông báo lỗi
                alert('Giỏ hàng của bạn đang trống!');
                return; // Dừng xử lý tiếp theo
            }
            // Tạo mảng chứa các sản phẩm từ giỏ hàng
            const products = cartData.items.map(item => ({
                productId: item.productId,
                quantity: item.quantity,
                price: item.productPrice
            }));

            const formData = {
                userId: iduser,
                customer: recipientName,
                address: recipientAddress,
                phone: recipientPhone,
                email: recipientEmail,
                totalPrice: cartData.totalPrice,
                products: products
            };
            // Phần này là gửi xuống server
            Checkout(formData);
        }); 

        // Xử lý sự kiện click trên nút "Clear"
        $('#clearCartBtn').click( function (event) {
            event.preventDefault();
             removeAllProducts();
        });
    });
</script>


    
   
    
 
    <!-- Lấy token từ Local Storage và gọi hàm fetchAndDisplayCart -->
            <script>
                // Gọi hàm fetchAndDisplayCart khi trang được load
                window.onload = async function() {
                    try {
                        await fetchAndDisplayCart(); // Gọi hàm fetchAndDisplayCart
                    } catch (error) {
                        console.error('Error:', error);
                    }
                };
            </script>
    
   
    
</body>

</html>